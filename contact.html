<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact — Adeyemi Emmanuel</title>
    <link rel="stylesheet" href="contact.css" />
  </head>
  <body>
    <div>
      <nav class="nav">
        <div><a href="index.html">Home</a></div>
        <div><a href="about.html">About me</a></div>
        <div><a href="contact.html" aria-current="page">Contact</a></div>
      </nav>
    </div>

    <article
      class="profile-card"
      aria-labelledby="profile-name"
      data-test-id="test-profile-card"
    >
      <h2 class="title">Get in Touch</h2>
      <form id="form" action="" novalidate aria-describedby="form-errors">
        <div>
          <label for="name">Full name</label><br />
          <input
            type="text"
            id="name"
            name="name"
            required
            data-testid="test-contact-name"
            aria-describedby="test-contact-error-name"
          />
          <span
            id="test-contact-error-name"
            data-testid="test-contact-error-name"
            role="alert"
            aria-live="assertive"
          ></span>
        </div>

        <div>
          <label for="email">Email</label><br />
          <input
            type="email"
            id="email"
            name="email"
            required
            data-testid="test-contact-email"
            aria-describedby="test-contact-error-email"
          />
          <span
            id="test-contact-error-email"
            data-testid="test-contact-error-email"
            role="alert"
            aria-live="assertive"
          ></span>
        </div>

        <div>
          <label for="subject">Subject</label><br />
          <input
            type="text"
            id="subject"
            name="subject"
            required
            data-testid="test-contact-subject"
            aria-describedby="test-contact-error-subject"
          />
          <span
            id="test-contact-error-subject"
            data-testid="test-contact-error-subject"
            role="alert"
            aria-live="assertive"
          ></span>
        </div>

        <div>
          <label for="message">Message</label><br />
          <textarea
            id="message"
            name="message"
            rows="4"
            required
            data-testid="test-contact-message"
            aria-describedby="test-contact-error-message"
          ></textarea>
          <span
            id="test-contact-error-message"
            data-testid="test-contact-error-message"
            role="alert"
            aria-live="assertive"
          ></span>
        </div>

        <div>
          <button type="submit" id="submit" data-testid="test-contact-submit">
            Submit
          </button>
        </div>

        <div
          id="success"
          data-testid="test-contact-success"
          role="status"
          aria-live="polite"
          style="display: none; margin-top: 1rem"
        ></div>
      </form>
    </article>

    <script>
      const form = document.getElementById("form");
      const nameInput = document.getElementById("name");
      const emailInput = document.getElementById("email");
      const subjectInput = document.getElementById("subject");
      const messageInput = document.getElementById("message");
      const successEl = document.getElementById("success");

      // form validation
      function showError(inputEl, errorId, message) {
        const errEl = document.getElementById(errorId);
        if (errEl) errEl.textContent = message;
        inputEl.setAttribute("aria-invalid", "true");
      }

      function clearError(inputEl, errorId) {
        const errEl = document.getElementById(errorId);
        if (errEl) errEl.textContent = "";
        inputEl.removeAttribute("aria-invalid");
      }

      function isNotEmpty(value) {
        return value.trim() != "";
      }

      function isValidEmail(value) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value.trim());
      }

      function isLongEnough(value) {
        return value.trim().length >= 10;
      }

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        successEl.style.display = "none";
        successEl.textContent = "";

        let isFormValid = true;
        let firstInvalid = null;

        //Name
        if (!isNotEmpty(nameInput.value)) {
          showError(
            nameInput,
            "test-contact-error-name",
            "Full name is required"
          );
          isFormValid = false;
          if (!firstInvalid) firstInvalid = nameInput;
        }

        // Email
        if (!isNotEmpty(emailInput.value)) {
          showError(
            emailInput,
            "test-contact-error-email",
            "Email is required."
          );
          isFormValid = false;
          if (!firstInvalid) firstInvalid = emailInput;
        } else if (!isValidEmail(emailInput.value)) {
          showError(
            emailInput,
            "test-contact-error-email",
            "Please enter a valid email address (name@example.com)."
          );
          isFormValid = false;
          if (!firstInvalid) firstInvalid = emailInput;
        }

        // Subject
        if (!isNotEmpty(subjectInput.value)) {
          showError(
            subjectInput,
            "test-contact-error-subject",
            "Subject is required."
          );
          isFormValid = false;
          if (!firstInvalid) firstInvalid = subjectInput;
        }

        // Message
        if (!isNotEmpty(messageInput.value)) {
          showError(
            messageInput,
            "test-contact-error-message",
            "Message is required."
          );
          isFormValid = false;
          if (!firstInvalid) firstInvalid = messageInput;
        } else if (!isLongEnough(messageInput.value, 10)) {
          showError(
            messageInput,
            "test-contact-error-message",
            "Message must be at least 10 characters."
          );
          isFormValid = false;
          if (!firstInvalid) firstInvalid = messageInput;
        }

        if (!isFormValid) {
          firstInvalid.focus();
          return;
        }

        successEl.style.display = "block";
        successEl.textContent =
          "Thanks! Your message has been sent — I will get back to you soon.";
        form.reset();

        clearError(nameInput, "test-contact-error-name");
        clearError(emailInput, "test-contact-error-email");
        clearError(subjectInput, "test-contact-error-subject");
        clearError(messageInput, "test-contact-error-message");

        nameInput.addEventListener("input", () => {
          if (isNotEmpty(nameInput.value))
            clearError(nameInput, "test-contact-error-name");
        });

        emailInput.addEventListener("input", () => {
          if (isValidEmail(emailInput.value))
            clearError(emailInput, "test-contact-error-email");
        });

        subjectInput.addEventListener("input", () => {
          if (isNotEmpty(subjectInput.value))
            clearError(subjectInput, "test-contact-error-subject");
        });

        messageInput.addEventListener("input", () => {
          if (isLongEnough(messageInput.value, 10))
            clearError(messageInput, "test-contact-error-message");
        });
      });
    </script>
  </body>
</html>
